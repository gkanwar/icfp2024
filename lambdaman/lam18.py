from evaluate import *
from ir import *

# problem 18

def draw_lam18():
    return '''
##################################################################################################################################################################################################################################################################################################
##############################################################################################################################################################################################......##############################################################################################
##############################################################################################################################################################################################.#.#################################################################################################
################################################################################################################################################################...#######################.......#################################################################################################
################################################################################################################################################################.#.........###############.###.###################################################################################################
################################################################################################################################################################.#..######.....................###################################################################################################
################################################################################################################################################################.#..######.####........###.###.###################################################################################################
###############################################################################################################################################..................#..######.####......................#############################################################################################
###############################################################################################################################################.######.###########..######.####..####..................###########################################################################################
###############################################################################################################################################.######.###########..######.####..###...........#####.#############################################################################################
###########################################################################################################################################.........##.###########..######.####..###...#####.#.#####.#.......#####################################################################################
##########################################################################################################################################...........#.###########..###########..###...#####.#######.#.#.#########################################################################################
##########################################################################################################################################..#...##...........#####..###########........#####.#######.#.#.#########################################################################################
#######################################################################################################################################..................#########.........#########...#####.####........#########################################################################################
#######################################################################################################################################.##..#...#.....##############################...#####.####.##.#.###########################################################################################
#######################################################################################################################################.##..##...#.......###########################...#####.####.##.#.###########################################################################################
#######################################################################################################################################.##..##...#.......###########################..###########.##.#.###########################################################################################
#######################################################################################################################################.##..##.#.#...###.###########################..###########.##.#.###########################################################################################
#######################################################################################################################################.##..#..#.#...###.###########################..####......................##################################################################################
##################################################################################################################################...................###.#################################.........###############################################################################################
#################################################################################################################################.....................##.#################################.#.####.################################################################################################
#################################################################################################################################..####..............#####################################.#.####.################################################################################################
#################################################################################################################################..####..#.##..........#################.......###########.#.####.################################################################################################
##############################################################################################################################........#..#.##........###################.......###########.#.####.################################################################################################
##############################################################################################################################.#...####..#..................############..###..####..........####.################################################################################################
#################################################################################################################..............#...####...........#.......##############..###..####.######.######.################################################################################################
#################################################################################################################...........##.#...####..#.##.....#..................###..###..####.######........################################################################################################
#########################################################################################################..........................####..#.##.........#.....############..###..####.........#####.################################################################################################
#########################################################################################################..........#............#..####..#.##...............................................######################################################################################################
#########################################################################################################...#####..#......................####....#...........#..........###..................####################################################################################################
#########################################################################################################...#####..#......###............#####..###..#......###.##..###..............####.#.######################################################################################################
#########################################################################################################...#####..#.......##...#.##.###....................###.##..###..............####.#.######################################################################################################
#########################################################################################################...#####........................##..................##.##..###..#...........####.#.######################################################################################################
#########################################################################################################...#####.#####...###...#.#.................##.#........................#....######.######################################################################################################
###########################################################################.........#####################......##.#####...###....................#...........##.##.....................####.######################################################################################################
###########################################################################.#######.##############..........###########..........................#.###.#..#.###.##.......##..#.##.#..######.######################################################################################################
###########################################################################.#######.##############..#.###...###########.........#.#...##.##............#............####.##..#.##.#..........#####################################################################################################
###########################################################################.#######.##############..#.###.#############.........###...##.####..#.#####.#..........#.####.##..#.##...........######################################################################################################
###########################################################################.#######.##########........################..........###......####..#.#####.........................####.##############################################################################################################
###########################################################################.#######.##########.###..##################............#....#...........#####..................#..........#############################################################################################################
###########################################################################.#######.##########.###..##################.#...............#...............#...............##.#....####.##############################################################################################################
###########################################################################.#######.##########.###..##################........#.###....#..######.#######....##.....########...........############################################################################################################
###########################################################################.#######.##########.###..################........#.##............####.#######...........##########..####.##.........###################################################################################################
########################################################################........###.#........................######.......#.#.##.###......######.#######....................#..####.##......##...#################################################################################################
########################################################################............#.########.########......######...........##.###..#...######.#######.............########..####.......####.#.........#########################################################################################
########################################################################.##.......###.########.########.####.#######..................#...######.#######...#.......#.#########.#####.#..######.#..######.....................#####################################################################
########################################################################.##..##.#.###.########.########...........##..................#...##############...#.........#########.#####.#..#.........######.####........#############################################################################
########################################################################.##..##.#.###.########.########...........##.......................############...........##...........#####.....................####.............########################################################################
########################################################################.##..##.#.###.########.#########.###.####.##..............#.#.##.........######.#..#..............##########.#..#.###..#..######.####.....##.#############################################################################
########################################################################.##.....#.###.########.#########.#..........................#.###############.............##.#################.........#..######.####.....##.#############################################################################
##############################################################................#######.########.#########....................................#########.#...........##.####################.###..#..######.####...#.##.#############################################################################
##############################################################.#######....#...#######.......##.#########..................#.............#############...##.....#####.####################.###..#..###########...#.##.#############################################################################
##############################################################......##....#...########.#######.#########.#........#.....#.##............##.........##............###.####################.###.....###########........#############################################################################
##############################################################.####....................#################.#...............................................#.##..#####.####################.######.........#####.##.##.####....#####################################################################
##############################################################..........#.###.########.#################.#...###..#.......###......................................#.####################.####################................####################################################################
##############################################################..###.#.........########.#################............................#.#.#..........................#.####################.####################.#####.###..##.#################################################..........##########
##############################################################..###.#..######.########.##################...###...........##....#....................................#################............############............###################################################......####.##########
##############################################################..#####..######.########.##################.............................#.#....#................###############...######.###################......########..######################################...........................#######
#########################################################.........###..######.########.##################...###...#....##.......#...#...#....#.....##.......#################.#.######.###########...........#..########...#####################################.########................#########
#########################################################.####...####..######.###########################...###........##...............#...................#################.#.######.###########.#######..##..################################################.########.###..##...##...........#
#########################################################.#####..####..####...###########################..............................................##...################........##.###########..........##..################################################.########.###..##........#########
#########################################################.#####........####.#.........###################.#.###..###...##..............#.....................##########......................#####................##############################################.########.###..##...##.#.#########
###################################.....########.########.#####.#####..####.#..######...........#########.#.###.####...##....#...............................##########.###..##.###.##############...#............##############################################.########.###..##...####.#########
#########################.........#.#............########.####..######.####.#..######.####.##############.#####.####..............#.#..............................####.###..##.###.##############...######.###.#.##############################################..........###..##...####.#########
#########################.#######.#.###########.....#####.#......................####.####.##############.#####.######.....#.#...##.#.....................##.######...............#.##############...######.###.#.##############################################..#.#.................##.#########
#########################....####.#.###########....................##########..######.##...........######.#####.........#...............###...#............#.######..##.##......#........####.....................##############################################.......##...############.#########
#########################.##.####.#.###########..########...##...############..######.##.#..................###..#####..#..#.#.#.##.#.#.###.......................#...........#.#.........###.####.......#..#####.#########.............#########################.#.#.###.#.############.#########
#########################.##............#######..########........############..#####........##.......###...#####.#####..##.#.#.#.##.#.#.#.......................###.............#..........##.####..........#####.#########.........###################........##.#.#.#####.############.#########
#########################.##............#######..########........############..#####..............##.###.#.#####.............................................##..............####....###............#.####..#####.#########...#####.###################.#.#######.#....####.######################
#########################.##.#.##..############..########....#..#############..#####..##.#..##.#####.###.#.#####.#####.###.#.#........#.............#..##.......#............####..........##.#####.#.####..#####.#########...#####.###################.#.#######.##..#####.######################
#########################.##.#.....############..#...........#..#############.........##.#..##.#####.###.#.#####.#########.#.#...##.#.#......................##.#......#.......##....###.......######.####....###.####........#####.###################.#.#######.##.........#####################
############################.#.##..##########......######.####..####################..##.#..##...........#.#####.#########.###...####.#.........##.....................#.##............#.......######.###########.####....##..#####.###################.#...#####.##.#############################
################........####.#.##..##............#.######.####..####################..##.#..##.#####.#####.#####.#############..####........................#..............................##..######.###########.........##..#####.#################......######.##.#############################
################.######............##.#######..#.#.######.####.#####################........########.#####.#####.#############..###........................................................##..###################.###..#.##..#####.#################.#.##.#......##.#############################
################.........###.#.######.#######..###.######.##############################........####.#####.#####.#############..###...###..............###.##.#.#..#...#........#..#..###...#..###################.....................##############.#.##.#.####.##.#############################
################.........#####.######.#######......######.###############################...########.#####.####..#############.####...###..............###.##.#....#...................................###########.###.......######.#######...........#.##.#.####.##.#############################
################..#####..#####.######.############.######################################...##############.####...........####.####....................###.##.#.............#...#..#..###...##.###......##########.######.##.######.#######.#########.#...........##.#############################
################....###..############.############.######################################.################.............#######..............#..........######.#.........................#.............############.######.##.##############.#########.####.#.#######.####......###################
################............#########.############.######################################.####################.........############.###.................#####.#......#.......................................#####.######.##.##############.#########.........###########.#.######################
################....####.############.###################################################.####################..######.############.###...................###.#.#...##.............#...##.................########.#####.........##########.########..........#######.......######################
###....................#.############.###################################################.####################..######.############.####...........#.#####...........#..#.........##.....L.................#############.........##########.########..###....########.###.########################
###.#######......................####........#################################################################..######.############.######.........#.#####..............#.......#.#.....##..##.#.....#.###############....##.........######....#####..###.###########.###.########################
###.#######.#.###.#.###..###...........##########################################################....................#.############.............................#...#####......##.#..................#.###############.#..##......##.######..#.........##.###########.###.########################
###.#######.#.....#.###..........#####.##########################################################.#######............#.##............#####.........#######..#..................##.#........................###########.#.........###.######..#...###............................##################
#.........#.#.#####.###..###......###############################################################.#.........##..##......................................##..#...#............................##...##.#.###############.#...#..##.###.######.......................................################
#.#.#####.#.#.#########..###......###############################################################.#.#####.#.........#####.########.........#.#.##.########..##..#......................#..#####...##.#.###############.#...#..##.#........................................#####.##################
#....####.#.#.#########..###..###.###############################################################.#....##.#.###.##.######......###....####.###.##.########..##..#..#.##.#.##...........#..#####...##.#.###############.................................#.##.#.#..#.####.#.#####.##################
#....####.#.#.#########..###..###.###############################################################.#....##.#.###.##.######......#......####.###.##.########..##.............................####...........#######.............#####..######..#..####...#.##.#.#..#.####.#######.##################
#.............#####......###...##.###############################################################.#.............##.######..###.................###########..###...........#...#######..########.#################.####.....#.........######..#..####...............####.#######.##################
#.#.#####.###...................#################################################################.....###.#.######.######..###..........######.###########.........#.##...#.......###..########.#################.####...#.#.######..######.##..###....#.#..#.......###.#######.##################
#.#.#####......###..###......#.#################################################################....#.#####.######.######...##......#.#.###....################...........#.......###..########.#################.####..##.#.######..######.....###................####.#######.##################
#.#.#####.####.###..###...##.#.#################################################################..#.#.#####.#####..##.......###.....#.#.###.###################...........#....##.###..##########################.####.....#.######....####.##........................#.#######.##################
###.#####.####.###..####..##.#.#################################################################..#.#.#####.##..............###.....###.###.#####......########................##.###....................########.####.#.#.################.#########..#.#..#....#.############.##################
###.#####.####.###..####..##.#.#################################################################....................#.###.#.###..................................................###############.#######.########.###....#.################.#########..#.#..#....#.############.##################
###.#####.####.###....##........################################################################..#.................#.##............###.###.#.##..###..##........................###############.#######.########............##############.########........#....############...........##########
###.##########.#############.#.################################################################................##.#.#.............#####.###.......#...........#...##......#.#.##################.#######.##.................###############.########.#...#.......############.####################
###.##########.#############.#.################################################################.#...######.#...##.#.#.##.##.##..........###.......#.#..##.........##........####################.#####..............####....#####################...........#.................####################
###.##########.###############.################################################################.#...######.##.........##.##.##......###......................................#################..............................#####################........##.##......##############################
###.###########################################################################################.#...######.##.........##.##.###.#.####............#....##.#..................#################.#.#####...##...####..####..#######################..#.............##.##############################
###.###########################################################################################.#...######.##..##.........#.###.#.####.....................................#.#######.............#####...##...####..####..#######################..#...#######...##.##############################
###############################################################################################.#...######.##..##......#..#####.#.####...##.............#.#......#...........#######.#.#####......####........####..####..#######################..#...#######..###.##############################
###############################################################################################.#...######.##.........##..#####.#.####...##.............###..............#.#.#######...........#######...##...####..####.########################..#.#.#######......##############################
###############################################################################################.#...#########...#..##.##..#####.#.####...................##..............#.#.#######...#####.#.#######..............#############################..#.#.############.##############################
###############################################################################################.....#########...#..##.##........#.####.#.##...#....##.#.###............#.###.#######...#####.#.#######..###.######........######################.....#.############.##############################
###########################################################################################.........##.............##.##...............#.###..#..........................###########...#####.#.#######..########........########################...###.############.##############################
###########################################################################################.#....#####.###.##.#.#..####......#.#######.#.###..##..........................##########...#####.#.#######..########........########################............######################################
###########################################################################################.#..#...........##.............##.#.#######.#.###..###......................#############...#####.#........##########...####.########################.#####.###########################################
###########################################################################################.#..#######.#####....#######...##.#.#######........##.....................#.#############............################...####.################..........####........####################################
###########################################################################################.#...######.#####.##.#######...##.#.########..###........####............##.#############...########.################..#####.################................##########################################
###########################################################################################.##########.####...........#......##########..####.##....####.....#.####.############...........#####################..#####.################..........#####.##########################################
###########################################################################################.##########................##.###.##########.#####.##....####.......####.###########............#####################..#####.################..###......###############################################
###########################################################################################.######....................##.###.##########.######.........#.....######.###########..###...###.#####################.######.################..###......###############################################
###########################################################################################.##.........####.#.#.#####.######.##########.######.#....##.#............###########..###...###.#####################.####......#############..###..#.#.###############################################
###########################################################################################............####.#..........################.######......##.#.....##################..###....##.#####################...........#############..###..#.#.###############################################
##############################################################################################.###.##..####.#....####.########################..............###################.........#############################.####.#########......###....#.###############################################
######################################################################################......................#....####.########################................#################.........#############################.####.####..................#################################################
#####################################################################################..........#...............#.####.########################.#.#.#........#####################.##..#.#############################.####......###..###............##############################################
######################################################################################.#######.#.#..#..#...........##.########################.#..............###############....................########...#########.####.####.###..###....#....#################################################
######################################################################################.#######.#.#...............#############################.#.#.#...#.##.#################.###.##.............########.#.........#.####.####.###..##..................#########################################
######################################################################################.#######.#.#...##.............############################.#.#...........##########...............#################.#..######........####.###..##.....#...##################################################
######################################################################################.######.......................############################.#.#.#......#############.###.#.#.###.#.....#############.#..######.######.####.###..............#################################################
######################################################################################.######....##..##.........###.############################.#.#.#......#############.###.#................................####.###....####.#######.###.#....#################################################
######################################################################################.######....##.......#.#...###.############################.#..........#############.###.#..............######.#######..######.###.##.####.#######.###.#.#.##################################################
####################################################################################.............##..#..................########################.#........#.############.....................######.#######..######.###..........######.###.###.##################################################
####################################################################################...............#.#....#.....###.############################.#........#.############...##.....###.#....#.######.#######..######.####.........######.###.######################################################
####################################################################################...####...............#......##.############################.#.###.........#########...##.#.#.#####.#..#.###.........##..###########.#.#####.######.###.######################################################
####################################################################################...####..#.#####.##...#..#..###.############################.#.###...###############...##.#.#.#####.#..#.###.........##..###########.#.#####.######.##..######################################################
####################################################################################..#####..#.#####.##......#..###.##############################.###...#########.........##.###.#####.#..#.###..#.####.##.........####.#######.######.##.#######################################################
####################################################################################..#####..#.#..........##.#.####.##############################.........#######.#####........#.###...#..#####....####.###############.#######.#.........#######################################################
####################################################################################..#####..#........#...##.#####################################..#....#########.#####........#.###.............######.###############.#######.#.####.##########################################################
####################################################################################.######..#...######.####.#####################################..#..#.#########.###........#.#.......#.######..######.##########......#######.#.###############################################################
####################################################################################.######..#...###########.#####################################..#..#.#########.###........#.##.###.....#####..######.##########...........##.#.###############################################################
####################################################################################..................######.######################################.#....#########.###.#...........###..#.######..######.######...........########.###############################################################
############################################################################################.#........#####..######################################.####.#########.###........#.##.###............######.######.###............###.###############################################################
##############################################################################################.#...##.#####.#######################################.####.#########.#........#.####...............#######.######.###................###############################################################
##############################################################################################.#............#######################################.#########......#.#....#.............#...........####.######.###.............##.###############################################################
################################################################################################..###.#####.#######################################.##........####.#.#....#.................##..###############........#.####..##....#############################################################
################################################################################################..###.#####.#######################################...........####.#.#........####..#...#.#.##..###############.##..........#..##....#############################################################
################################################################################################.........##.#######################################...........####.#........................##..###############.##.#...######..##..#.#############################################################
################################################################################################.##########.#######################################.##.######.####.#.............#..#...........###############.####...######..##.##.#############################################################
################################################################################################.##########.#######################################.##.######.####.#....###.#..........##.#####################.####...######..##.##.#############################################################
################################################################################################.##########.#######################################.##.######.####.#..........####..........###################.####...#######.#........##########################################################
################################################################################################.##########.#######################################.##.######.####.#........#.####.##..##.##########################...#######.#.#################################################################
################################################################################################.##########.#######################################.##.######.######.#..###.#.####.##..##.#######################...........####.#################################################################
################################################################################################.##################################################.#...#####.######.#..#####.####.##..#########################.......#########.#################################################################
################################################################################################.##################################################.#...#####.######.#......#.####.###.#########################..###..#########.#################################################################
###################################################################################################################################################.#.#.#####.######.########.####.###.#########################..###..#########.#################################################################
###################################################################################################################################################........##.######.########.##################################..###..#########.#################################################################
####################################################################################################################################################.......#########.###########################################..###..#########.#################################################################
####################################################################################################################################################.###############.###########################################.........#######.#################################################################
####################################################################################################################################################.###############.################################################..#########.#################################################################
####################################################################################################################################################.###############.################################################..########..#################################################################
####################################################################################################################################################.################################################################..########.##################################################################
####################################################################################################################################################.################################################################...........##################################################################
####################################################################################################################################################.##########################################################################.##################################################################
####################################################################################################################################################.##########################################################################.##################################################################
####################################################################################################################################################.##########################################################################.##################################################################
####################################################################################################################################################.##########################################################################.##################################################################
###############################################################################################################################################################################################################################.##################################################################
###############################################################################################################################################################################################################################.##################################################################
###############################################################################################################################################################################################################################.##################################################################
###############################################################################################################################################################################################################################.##################################################################
##################################################################################################################################################################################################################################################################################################
    '''

def solve_lam18(grid, f):
    grid = list(map(lambda x: list(x.strip()), grid.strip().split('\n')))
    i, j = 0, 0
    for x,row in enumerate(grid):
        for y,c in enumerate(row):
            if c == 'L':
                i, j = x, y
                break
    print(f'Found {i} {j}')
    width, height = len(grid[0]), len(grid)
    def move(d):
        nonlocal i, j
        if d == 'R':
            if (j < width-1) and grid[i][j+1] != '#':
                grid[i][j] = ' '
                grid[i][j+1] = 'L'
                j += 1
        elif d == 'L':
            if (j > 0) and grid[i][j-1] != '#':
                grid[i][j] = ' '
                grid[i][j-1] = 'L'
                j -= 1
        elif d == 'U':
            if (i > 0) and grid[i-1][j] != '#':
                grid[i][j] = ' '
                grid[i-1][j] = 'L'
                i -= 1
        else:
            assert d == 'D'
            if (i < height-1) and grid[i+1][j] != '#':
                grid[i][j] = ' '
                grid[i+1][j] = 'L'
                i += 1
    soln = f()
    for c in soln:
        move(c)
    print('\n'.join([''.join(row) for row in grid]))
    return all(map(lambda row: all(map(lambda c: c != '.', row)), grid))

def dir_str(x):
    # n = (x//4) % 2
    n = 1
    if x % 4 == 0: return 'D'*n
    elif x % 4 == 1: return 'U'*n
    elif x % 4 == 2: return 'R'*n
    else: return 'L'*n
def make_f_rand_walk(seed, g, p, n_iter):
    def f_rand_walk():
        x = seed
        out = ''
        for i in range(n_iter):
            out += dir_str(x)
            x *= g
            x %= p
        return out
    return f_rand_walk

if __name__ == '__main__':
    grid = draw_lam18()
    # print(grid)
    # solve_lam11(grid, f)

    p = 1000000009
    g = 13
    # p = 131071
    # g = 3
    n = 1000000
    for seed in range(1000):
        f = make_f_rand_walk(seed, g, p, n)
        if solve_lam18(grid, f):
            print(f'SUCCESS {seed}')
            break
    else:
        print(f'FAILED!')
